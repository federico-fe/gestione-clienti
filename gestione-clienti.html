<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Clienti e Reminder - Eisenhower</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">
    <h2>Gestione Clienti e Reminder (Matrice di Eisenhower)</h2>

    <form id="clienteForm" class="my-3">
        <input type="text" id="nomeCliente" placeholder="Nome cliente" class="form-control mb-2" required>
        <input type="text" id="aziendaCliente" placeholder="Azienda" class="form-control mb-2" required>
        <input type="text" id="oggettoIncontro" placeholder="Oggetto incontro" class="form-control mb-2" required>
        <input type="date" id="dataIncontro" class="form-control mb-2" required>

        <select id="eisenhower" class="form-select mb-2">
            <option value="UI">Urgente e Importante</option>
            <option value="UNI">Urgente ma Non Importante</option>
            <option value="NUI">Non Urgente ma Importante</option>
            <option value="NUNI">Non Urgente e Non Importante</option>
        </select>

        <button type="submit" class="btn btn-primary">Aggiungi cliente</button>
    </form>

    <input type="text" id="ricerca" placeholder="Ricerca per nome o azienda..." class="form-control mb-3">

    <select id="filtroEisenhower" class="form-select mb-3">
        <option value="TUTTI">Tutte le priorit√†</option>
        <option value="UI">Urgente e Importante</option>
        <option value="UNI">Urgente ma Non Importante</option>
        <option value="NUI">Non Urgente ma Importante</option>
        <option value="NUNI">Non Urgente e Non Importante</option>
    </select>

    <h4>Clienti registrati</h4>
    <ul id="listaClienti" class="list-group"></ul>
</div>

<script>
    let clienti = JSON.parse(localStorage.getItem('clienti')) || [];

    function aggiornaLista() {
        const ricerca = document.getElementById('ricerca').value.toLowerCase();
        const filtro = document.getElementById('filtroEisenhower').value;

        const lista = document.getElementById('listaClienti');
        lista.innerHTML = '';

        clienti.forEach((cliente, index) => {
            if ((cliente.nome.toLowerCase().includes(ricerca) || cliente.azienda.toLowerCase().includes(ricerca)) &&
                (filtro === 'TUTTI' || cliente.eisenhower === filtro)) {
                const item = document.createElement('li');
                item.className = 'list-group-item';
                item.innerHTML = `<strong>${cliente.nome}</strong> (${cliente.azienda}) - ${cliente.oggetto}, ${cliente.data} <span class="badge bg-info">${cliente.eisenhower}</span>
                <button class="btn btn-sm btn-warning float-end me-2" onclick="modificaCliente(${index})">Modifica</button>
                <button class="btn btn-sm btn-danger float-end me-2" onclick="eliminaCliente(${index})">Elimina</button>`;
                lista.appendChild(item);
            }
        });
    }

    function eliminaCliente(index) {
        clienti.splice(index, 1);
        localStorage.setItem('clienti', JSON.stringify(clienti));
        aggiornaLista();
    }

    function modificaCliente(index) {
        const cliente = clienti[index];
        document.getElementById('nomeCliente').value = cliente.nome;
        document.getElementById('aziendaCliente').value = cliente.azienda;
        document.getElementById('oggettoIncontro').value = cliente.oggetto;
        document.getElementById('dataIncontro').value = cliente.data;
        document.getElementById('eisenhower').value = cliente.eisenhower;

        clienti.splice(index, 1);
        localStorage.setItem('clienti', JSON.stringify(clienti));
        aggiornaLista();
    }

    document.getElementById('clienteForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const nuovoCliente = {
            nome: document.getElementById('nomeCliente').value,
            azienda: document.getElementById('aziendaCliente').value,
            oggetto: document.getElementById('oggettoIncontro').value,
            data: document.getElementById('dataIncontro').value,
            eisenhower: document.getElementById('eisenhower').value
        };

        clienti.push(nuovoCliente);
        localStorage.setItem('clienti', JSON.stringify(clienti));
        aggiornaLista();
        this.reset();
    });

    document.getElementById('ricerca').addEventListener('input', aggiornaLista);
    document.getElementById('filtroEisenhower').addEventListener('change', aggiornaLista);

    aggiornaLista();
</script>
</body>
</html>
